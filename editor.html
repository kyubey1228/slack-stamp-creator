<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stamp Editor</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f8f8f8;
      overflow: hidden;
    }
    .editor-container {
      display: flex;
      height: 100vh;
    }
    .canvas-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #2d2d2d;
      position: relative;
    }
    #editorCanvas {
      max-width: 90%;
      max-height: 90%;
      background: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    #videoPreview {
      max-width: 90%;
      max-height: 90%;
      display: none;
    }
    .sidebar {
      width: 320px;
      background: white;
      padding: 20px;
      overflow-y: auto;
      box-shadow: -2px 0 8px rgba(0,0,0,0.1);
    }
    h2 {
      font-size: 16px;
      margin-bottom: 16px;
      color: #1d1c1d;
    }
    .control-group {
      margin-bottom: 24px;
    }
    label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: #616061;
      margin-bottom: 8px;
    }
    input[type="text"], input[type="number"], input[type="range"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
    }
    input[type="range"] {
      padding: 0;
    }
    input[type="color"] {
      width: 100%;
      height: 40px;
      border: 1px solid #ddd;
      border-radius: 4px;
      cursor: pointer;
    }
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 12px;
    }
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      cursor: pointer;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }
    .primary {
      background: #611f69;
      color: white;
    }
    .primary:hover {
      background: #4a154b;
    }
    .secondary {
      background: #f8f8f8;
      color: #1d1c1d;
      border: 1px solid #ddd;
    }
    .secondary:hover {
      background: #e8e8e8;
    }
    .danger {
      background: #e01e5a;
      color: white;
    }
    .danger:hover {
      background: #c91d4e;
    }
    .status {
      padding: 12px;
      border-radius: 4px;
      font-size: 13px;
      margin-bottom: 12px;
      display: none;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      display: block;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      display: block;
    }
    .status.info {
      background: #d1ecf1;
      color: #0c5460;
      display: block;
    }
    .value-display {
      display: inline-block;
      margin-left: 8px;
      font-weight: 600;
      color: #611f69;
    }
    .video-controls {
      display: none;
    }
    .gif-preview {
      margin-top: 12px;
      display: none;
    }
    .gif-preview img {
      width: 100%;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    .crop-overlay {
      position: absolute;
      border: 2px dashed #00ff00;
      background: rgba(0, 255, 0, 0.1);
      cursor: move;
      display: none;
      pointer-events: all;
      z-index: 10;
    }
    .canvas-area {
      position: relative;
    }
    .crop-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #00ff00;
      border: 2px solid white;
      border-radius: 50%;
      pointer-events: auto;
      cursor: nwse-resize;
    }
    .crop-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }
    .crop-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }
    .crop-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }
    .crop-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }
    .selecting-crop {
      cursor: crosshair !important;
    }
  </style>
</head>
<body>
  <div class="editor-container">
    <div class="canvas-area" id="canvasArea">
      <canvas id="editorCanvas"></canvas>
      <video id="videoPreview" controls></video>
      <div class="crop-overlay" id="cropOverlay">
        <div class="crop-handle nw"></div>
        <div class="crop-handle ne"></div>
        <div class="crop-handle sw"></div>
        <div class="crop-handle se"></div>
      </div>
    </div>
    
    <div class="sidebar">
      <h2>âœï¸ ç·¨é›†</h2>
      
      <div class="status" id="status"></div>
      
      <!-- ç”»åƒãƒ¢ãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
      <div id="imageControls">
        <div class="control-group">
          <label>ãƒˆãƒªãƒŸãƒ³ã‚°</label>
          <button class="secondary" id="cropBtn">ç¯„å›²ã‚’é¸æŠã—ã¦ãƒˆãƒªãƒŸãƒ³ã‚°</button>
          <button class="secondary" id="resetCropBtn">å…ƒã«æˆ»ã™</button>
        </div>
        
        <div class="control-group">
          <div class="checkbox-group">
            <input type="checkbox" id="chromakeyEnabled">
            <label for="chromakeyEnabled" style="margin: 0;">ã‚¯ãƒ­ãƒã‚­ãƒ¼åˆæˆ</label>
          </div>
          <label>é™¤å»ã™ã‚‹è‰²</label>
          <input type="color" id="chromakeyColor" value="#00ff00">
          <label>
            æ„Ÿåº¦
            <span class="value-display" id="sensitivityValue">30</span>
          </label>
          <input type="range" id="chromakeySensitivity" min="1" max="100" value="30">
        </div>
        
        <div class="control-group">
          <label>å‡ºåŠ›ã‚µã‚¤ã‚º</label>
          <p style="font-size: 12px; color: #616061; margin: 0;">
            ç”»åƒ: 128x128px (Slackæ¨å¥¨ã‚µã‚¤ã‚º)<br>
            GIF: 1MBä»¥ä¸‹ (Slackåˆ¶é™)
          </p>
        </div>
      </div>
      
      <!-- å‹•ç”»ãƒ¢ãƒ¼ãƒ‰ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« -->
      <div id="videoControls" class="video-controls">
        <div class="control-group">
          <label>ğŸ¬ æ™‚é–“ç¯„å›²ã®è¨­å®š</label>
          <label>é–‹å§‹æ™‚é–“ (ç§’)</label>
          <input type="number" id="startTime" value="0" min="0" step="0.1">
        </div>

        <div class="control-group">
          <label>çµ‚äº†æ™‚é–“ (ç§’)</label>
          <input type="number" id="endTime" value="3" min="0" step="0.1">
        </div>

        <div class="control-group">
          <label>âœ‚ï¸ å‹•ç”»é ˜åŸŸã®ãƒˆãƒªãƒŸãƒ³ã‚°</label>
          <div class="checkbox-group">
            <input type="checkbox" id="videoCropEnabled">
            <label for="videoCropEnabled" style="margin: 0;">ãƒˆãƒªãƒŸãƒ³ã‚°ã‚’æœ‰åŠ¹åŒ–</label>
          </div>
          <button class="secondary" id="selectVideoCropArea">ç¯„å›²ã‚’é¸æŠ</button>
          <button class="secondary" id="resetVideoCrop">ãƒªã‚»ãƒƒãƒˆ</button>
          <div id="cropInfo" style="font-size: 11px; color: #616061; margin-top: 8px; display: none;">
            ç¯„å›²: <span id="cropDimensions"></span>
          </div>
        </div>

        <div class="control-group">
          <label>
            FPS
            <span class="value-display" id="fpsValue">10</span>
          </label>
          <input type="range" id="fps" min="5" max="30" value="10" step="5">
        </div>

        <div class="control-group">
          <label>
            å¹… (px)
            <span class="value-display" id="gifWidthValue">320</span>
          </label>
          <input type="range" id="gifWidth" min="128" max="512" value="320" step="64">
        </div>

        <div class="control-group">
          <button class="secondary" id="generateGif">GIFã‚’ç”Ÿæˆ</button>
        </div>

        <div class="gif-preview" id="gifPreview">
          <img id="gifImage" alt="GIF Preview">
        </div>
      </div>
      
      <div class="control-group">
        <label>çµµæ–‡å­—å</label>
        <input type="text" id="emojiName" placeholder="my_custom_emoji" pattern="[a-z0-9_-]+">
        <small style="color: #616061; font-size: 11px;">å°æ–‡å­—ã€æ•°å­—ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã€ãƒã‚¤ãƒ•ãƒ³ã®ã¿</small>
      </div>
      
      <button class="primary" id="uploadBtn">
        ğŸ’¾ ä¿å­˜ã—ã¦Slackãƒšãƒ¼ã‚¸ã‚’é–‹ã
      </button>
      
      <button class="secondary" id="downloadBtn">
        ğŸ“¥ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ã¿
      </button>
      
      <button class="danger" id="closeBtn">
        é–‰ã˜ã‚‹
      </button>
    </div>
  </div>

  <script src="gif.js"></script>
  <script src="editor.js"></script>
</body>
</html>
